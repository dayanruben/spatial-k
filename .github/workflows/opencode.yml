name: opencode

on:
    issue_comment:
        types: [created]

jobs:
    opencode:
        if: |
            contains(github.event.comment.body, ' /oc') ||
            startsWith(github.event.comment.body, '/oc') ||
            contains(github.event.comment.body, ' /opencode') ||
            startsWith(github.event.comment.body, '/opencode')
        runs-on: ubuntu-latest
        permissions:
            contents: read
            id-token: write
        steps:
            - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
              with:
                  fetch-depth: 0
                  fetch-tags: true
                  persist-credentials: false
            - uses: sst/opencode/github@568484df741ab9edfb67df80911a965a06e8dafb # v1.0.6
              env:
                  OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
              with:
                  model: openrouter/z-ai/glm-4.6
