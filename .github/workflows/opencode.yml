name: opencode

on:
    issue_comment:
        types: [created]

jobs:
    opencode:
        if: |
            contains(github.event.comment.body, ' /oc') ||
            startsWith(github.event.comment.body, '/oc') ||
            contains(github.event.comment.body, ' /opencode') ||
            startsWith(github.event.comment.body, '/opencode')
        runs-on: ubuntu-latest
        permissions:
            contents: read
            id-token: write
        steps:
            - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
              with:
                  fetch-depth: 0
                  fetch-tags: true
                  persist-credentials: false
            - uses: sst/opencode/github@27c211ef869cae9d18b3fefc36ba787af75ebde0 # v0.14.5
              env:
                  ZHIPU_API_KEY: ${{ secrets.ZHIPU_API_KEY }}
              with:
                  model: zai-coding-plan/glm-4.6
